%div.row
  %div.col-md-6
    %ol.breadcrumb
      %li
        = link_to t('layout.home'), root_path
      %li.active
        = t('congressmen.breadcrumb')
  %div.col-md-6
    %ul.list-inline.pull-right
      %li
        - url = 'https://www.facebook.com/sharer/sharer.php?u='+request.original_url
        %a.btn-warning.btn-xs{'href'=>'#', 'onclick'=>'window.open("'+url+'","facebook","width=450, height=250")'}
          %i.fa.fa-facebook 
          = t("congressmen.fb_share")

      %li
        - url = 'https://twitter.com/share?url='+request.original_url+'&via=ciudadanoi&hashtags='+ENV['twitter_tags']
        %a.btn-warning.btn-xs{'href'=>'#', 'onclick'=>'window.open("'+url+'","twitter","width=450, height=250")'}
          %i.fa.fa-twitter 
          = t("congressmen.tw_share")

%div.row
  %h2
    = t('congressmen.title')
  %div.col-md-3.aside
    = render :partial => "filter_search_form"
  %div.col-md-9.whitewithaside
    - @congressmen.each do | congressman |

      %div.row.result
        %div.col-md-1
          - if ! congressman.images.blank?
            - fantasy_name = Rack::Utils.escape(I18n.transliterate(congressman.name.gsub("'", "")))
            - if ! File.exist?('app/assets/images/'+fantasy_name+'.jpg')
              - image = Magick::ImageList.new
              - begin
                - timeout(2) do
                  - url_image = open(congressman.images[0].url)
              - rescue Timeout::Error
                - url_image = open('app/assets/images/default-profile.png')
              - image.from_blob(url_image.read)
              - crop = image.crop(15,15,160,150)
              - crop.write('app/assets/images/'+fantasy_name+'.jpg')
            = image_tag(fantasy_name+'.jpg', class: "img-circle img-responsive")
          - else
            = image_tag('default-profile.png', class: "img-circle img-responsive")
        %div.col-md-10
          %h5
            = link_to congressman.name, congressman_path(congressman.id)
          - if ! congressman.title.blank?
            = congressman.title
          - if ! congressman.represent[0].region.blank?
            %p
              %span.light
                = t('congressmen.represent')
              = congressman.represent[0].region
        %div.col-md-1
          = link_to url_for(controller: "communications", action: "index", id: congressman.id) do
            %span.visible-xs
              = t('congressmen.askthem')
            %i.fa.fa-envelope-o.hidden-xs{title: t('congressmen.askthem')}

    / Disable pagination
    / %div.pull-left
    /   - if ! @congressmen.prev_url.blank?
    /     = link_to congressmen_path + '/?page=' + (@congressmen.page - 1).to_s, :class => 'btn btn-default' do
    /       %i.fa.fa-long-arrow-left
    /       = t('pagination.previous')
    / %div.pull-right
    /   - if ! @congressmen.next_url.blank?
    /     - if @congressmen.has_more
    /       = link_to congressmen_path + '/?page=' + (@congressmen.page + 1).to_s, :class => 'btn btn-default' do
    /         = t('pagination.next')
    /         %i.fa.fa-long-arrow-right
