%section#graph
  :javascript
    freq = #{@date_freq};

  = javascript_include_tag 'svg/jquery.svg.min.js'
  = javascript_include_tag 'svg/jquery.svgdom.min.js'
  = javascript_include_tag 'svg/jquery.svganim.min.js'
  = javascript_include_tag 'svg/graph-bill.js'

  %h4.hidden-xs
    EVENTOS QUE HA TENIDO ESTE PROYECTO

  %div.hidden-xs
    %svg.graph{'version'=>'1.1', 'xmlns:xlink'=>"http://www.w3.org/1999/xlink", 'xmlns'=>"http://www.w3.org/2000/svg", 'width'=>"800", 'height'=>"200"}
      %g.grid.y-grid#yGrid
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"0", 'y2'=>"0"}
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"40", 'y2'=>"40"}
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"80", 'y2'=>"80"}
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"120", 'y2'=>"120"}
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"160", 'y2'=>"160"}
        %line{'x1'=>"80", 'x2'=>"800", 'y1'=>"200", 'y2'=>"200"}
        
      /radial gradient
      %defs
        %radialGradient#gradientShadow{'cx'=>'50%', 'cy'=>'50%', 'fx'=>'50%', 'fy'=>'50%', 'r'=>'55%'}
          %stop{'offset'=>'0%', 'style'=>'stop-color:rgb(0,0,0); stop-opacity:1'}
          %stop{'offset'=>'100%', 'style'=>'stop-color:#AAA; stop-opacity:0'}
      /surface
      %g.surfaces#surfaces
      /grid lines
      %use.grid.double{'xlink:href'=>'#xGrid','style'=>''}
      %use.grid.double{'xlink:href'=>'#yGrid','style'=>''}
      /points
      %g#points.first_set.points{'data-setname'=>'set de datos'}
      /labels
      %g.labels.x-labels
        
      %g.labels.y-labels
        %text{'x'=>'100', 'y'=>'20'}
          Nro tramitaciones
        %text{'x'=>'80', 'y'=>'0'}
          10
        %text{'x'=>'80', 'y'=>'40'}
          8
        %text{'x'=>'80', 'y'=>'80'}
          6
        %text{'x'=>'80', 'y'=>'120'}
          4
        %text{'x'=>'80', 'y'=>'160'}
          2
        %text{'x'=>'80', 'y'=>'200'}
          0

    %div#tooltip
      %svg
        %polygon#tooltip-triangle{'points'=>'0,0 11,13 0,13'}
      %p#tooltip-title
      %div.value
        %span.value-part
        %span.value-total
          eventos
  /the graph

  - if ! @bill.paperworks.blank?
    %h4{name:'timeline'}
      HISTORIA DEL PROYECTO
      
      = link_to 'Descargar historial', params.merge(:format => :xls)
    
    %div.row.visible-xs
      %div.col-xs-5
        %button.down.btn
          %i.fa.fa-chevron-circle-down
          Más recientes
      %div.col-xs-5
        %button.up.btn
          %i.fa.fa-chevron-circle-up
          Menos reciente
    
    %div.pull-right.hidden-xs
      Invertir orden temporal
      %a.down{'href'=>'#'}
        %i.fa.fa-chevron-circle-down
      %a.up{'href'=>'#'}
        %i.fa.fa-chevron-circle-up
    
    %div#timeline.row
      - @bill.paperworks.each_with_index do | paperwork, index |
        %div{ 'data-sort' => index.to_s }
          %div.timeline-container
          %div.resume.col-md-11
            %h5
              = paperwork.description
              %span.light
                = Date.parse(paperwork.date).strftime("%d de %B, %Y")

            %p
              = paperwork.stage
            
            - if paperwork.chamber.length > 1
              %p
                Cámara:
                %strong
                  = paperwork.chamber

            - if paperwork.session.length > 1
              %p
                Sesión:
                %strong
                  = paperwork.session

:javascript
  $('.up').on('click', function(e){
    e.preventDefault();
    $("div#timeline>div").tsort({order:'asc', data:'sort'});
  });

  $('.down').on('click', function(e){
    e.preventDefault();
    $("div#timeline>div").tsort({order:'desc', data:'sort'});
  });